import { fyersModel ,fyersDataSocket , fyersOrderSocket} from "../index.js"
// const WebSocket = window.WebSocket || window.MozWebSocket;
const order_socket = document.querySelector('.id')
const cookie_id = document.querySelector('.cookie_id')
const data_socket = document.querySelector('.data_socket')
const apis = document.querySelector('.apis')

const access_token = "FNG7034WFS-100:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJhcGkuZnllcnMuaW4iLCJpYXQiOjE3MTM1MDE2NTAsImV4cCI6MTcxMzU3MzA1MCwibmJmIjoxNzEzNTAxNjUwLCJhdWQiOlsieDowIiwieDoxIiwieDoyIiwiZDoxIiwiZDoyIiwieDoxIiwieDowIl0sInN1YiI6ImFjY2Vzc190b2tlbiIsImF0X2hhc2giOiJnQUFBQUFCbUlmWFNIbmtiMWQzMWRfa3NaVzdDVGo3UUlsRXdmMGRwSXZpMXh1TXk0eE52WGkwX2tqUm1GRTE4d2N6bDl0cTJ0ZFV1ZGFadVV6WTdmdkJzM1VaU3lWLWplalNmOHdLamcxRTVGX19RNEFZemltcz0iLCJkaXNwbGF5X25hbWUiOiJDSEFORFJBU0hFS0FSIFJBS1NISVRIIEdPV0RBIiwib21zIjoiSzEiLCJoc21fa2V5IjoiYTAyOWY3OGE4ZTczNGM1ZWU5NmFkNDJkZjRiYjRmOTFlM2JhODU1OWViMmJiZWMxMGIzYzdiYzMiLCJmeV9pZCI6IllDMDAyMDciLCJhcHBUeXBlIjoxMDAsInBvYV9mbGFnIjoiTiJ9._4tD9nuptFm24bM_jypycmyjH4TeTScZ5p87eID5kmM"

order_socket.addEventListener('click',()=>{
    var skt=new fyersOrderSocket(access_token)
    skt.on("error",function (errmsg) {
        console.log(errmsg)
    })
    skt.on('general',function (msg) {
        console.log("message", msg)
    })
    skt.on('connect',function () {
        skt.subscribe([skt.orderUpdates,skt.tradeUpdates,skt.positionUpdates,skt.edis,skt.pricealerts])
        console.log(skt.isConnected())
    })
    skt.on('close',function () {
        console.log('closed')
    })
    skt.on('orders',function (msg) {
        console.log("orders",msg)
    })
    skt.on('trades',function (msg) {
        console.log('trades',msg)
    })
    skt.on('positions',function (msg) {
        console.log('positions',msg)
    })
    // skt.autoreconnect()
    skt.connect()
})

cookie_id.addEventListener('click',()=>{
    const expirationDate = new Date();
    const value = ""
    expirationDate.setDate(expirationDate.getDate() + 1);

    const cookieString = `${"_FYERS"}=${encodeURIComponent(value)}; expires=${expirationDate.toUTCString()}; path=/`;
    
    document.cookie = cookieString;
})
data_socket.addEventListener('click',()=>{
    console.log("HI")
    var skt= fyersDataSocket.getInstance(access_token)
    skt.on("connect",function(){
        skt.subscribe(['NSE:BHARATFORG-EQ' , 'NSE:HDFCBANK-EQ'],false,1)
    skt.mode(skt.FullMode,1)
    console.log(skt.isConnected())
    skt.unsubscribe(['NSE:HDFCBANK-EQ'],false,1)
    })

    skt.on("message",function(message){
        console.log({"TEST":message})
    })

    skt.on("error",function(message){
        console.log("erroris",message)
    })

    skt.on("close",function(){
        console.log("socket closed")
    })
    skt.connect()
    skt.autoreconnect()
})

apis.addEventListener('click',()=>{
    const fyersApi =new fyersModel()
    fyersApi.setAppId('FNG7034WFS-100')
    fyersApi.setAccessToken("eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJhcGkuZnllcnMuaW4iLCJpYXQiOjE3MTM1MDE2NTAsImV4cCI6MTcxMzU3MzA1MCwibmJmIjoxNzEzNTAxNjUwLCJhdWQiOlsieDowIiwieDoxIiwieDoyIiwiZDoxIiwiZDoyIiwieDoxIiwieDowIl0sInN1YiI6ImFjY2Vzc190b2tlbiIsImF0X2hhc2giOiJnQUFBQUFCbUlmWFNIbmtiMWQzMWRfa3NaVzdDVGo3UUlsRXdmMGRwSXZpMXh1TXk0eE52WGkwX2tqUm1GRTE4d2N6bDl0cTJ0ZFV1ZGFadVV6WTdmdkJzM1VaU3lWLWplalNmOHdLamcxRTVGX19RNEFZemltcz0iLCJkaXNwbGF5X25hbWUiOiJDSEFORFJBU0hFS0FSIFJBS1NISVRIIEdPV0RBIiwib21zIjoiSzEiLCJoc21fa2V5IjoiYTAyOWY3OGE4ZTczNGM1ZWU5NmFkNDJkZjRiYjRmOTFlM2JhODU1OWViMmJiZWMxMGIzYzdiYzMiLCJmeV9pZCI6IllDMDAyMDciLCJhcHBUeXBlIjoxMDAsInBvYV9mbGFnIjoiTiJ9._4tD9nuptFm24bM_jypycmyjH4TeTScZ5p87eID5kmM")
    fyersApi.setRedirectUrl("https://trade.fyers.in/api-login/redirect-uri/index.html")
    fyersApi.getOptionChain({"symbol":"NSE:SBIN-EQ","strikecount":1}).then((response)=>{
        console.log(response.data)
    })
})
